<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DUMP TABLE and RESTORE TABLE Statements &mdash; OmniSciDB  documentation</title>
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.webp"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/segment_analytics.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> OmniSciDB
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">System Architecture</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">1. OmniSciDB at 30,000 Feet</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview/index.html#high-level-diagram">1.1. High Level Diagram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/index.html#data-model">1.2. Data Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/index.html#data-flow">1.3. Data Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/index.html#query-execution">1.4. Query Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/index.html#simplified-execution-model">1.5. Simplified Execution Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/getting_started.html">2. Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/deps.html">2.1. Server Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart/deps.html#prebuilt-dependencies">2.1.1. Prebuilt Dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../quickstart/deps.html#environment-variables">2.1.1.1. Environment Variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart/deps.html#building-on-ubuntu">2.1.2. Building on Ubuntu</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../quickstart/deps.html#ubuntu-16-04">2.1.2.1. Ubuntu 16.04</a></li>
<li class="toctree-l4"><a class="reference internal" href="../quickstart/deps.html#ubuntu-18-04-and-20-04">2.1.2.2. Ubuntu 18.04 and 20.04</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart/deps.html#building-on-centos">2.1.3. Building on CentOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart/deps.html#building-on-macos">2.1.4. Building on macOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart/deps.html#building-on-arch-linux">2.1.5. Building on Arch Linux</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/build.html">2.2. Build OmniSciDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/start.html">2.3. Start and Load Sample Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart/start.html#starting-the-server">2.3.1. Starting the Server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../quickstart/start.html#starting-manually">2.3.1.1. Starting Manually</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart/start.html#working-with-data">2.3.2. Working With Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../catalog/index.html">3. Catalog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../catalog/index.html#high-level-overview">3.1. High Level Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../catalog/index.html#system-schema-syscatalog">3.2. System Schema (SysCatalog)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#users">3.2.1. Users</a></li>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#roles">3.2.2. Roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#databases">3.2.3. Databases</a></li>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#permissions">3.2.4. Permissions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../catalog/index.html#database-schema-catalog">3.3. Database Schema (Catalog)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#tables">3.3.1. Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#columns">3.3.2. Columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#dictionaries">3.3.3. Dictionaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#sharded-tables">3.3.4. Sharded Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#views">3.3.5. Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#temporary-tables">3.3.6. Temporary Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#dashboards">3.3.7. Dashboards</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../catalog/index.html#migration">3.4. Migration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html">4. Data Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="columnar_layout.html">4.1. Columnar Data Organization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="columnar_layout.html#columns">4.1.1. Columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="columnar_layout.html#fragments">4.1.2. Fragments</a></li>
<li class="toctree-l3"><a class="reference internal" href="columnar_layout.html#chunks">4.1.3. Chunks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="columnar_layout.html#example-for-chunk-physical-representations">4.1.3.1. Example for chunk physical representations</a></li>
<li class="toctree-l4"><a class="reference internal" href="columnar_layout.html#chunkkey">4.1.3.2. ChunkKey</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="physical_layout.html">4.2. Physical Data Layout</a><ul>
<li class="toctree-l3"><a class="reference internal" href="physical_layout.html#directory-structure">4.2.1. Directory Structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="physical_layout.html#epoch">4.2.1.1. Epoch</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="physical_layout.html#data-multipages">4.2.2. Data Multipages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="physical_layout.html#example-data-page">4.2.2.1. Example Data Page:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="physical_layout.html#metadata-pages">4.2.3. Metadata Pages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="memory_layout.html">4.3. Memory  Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">4.4. External API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api.html#design">4.4.1. Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html#protocols">4.4.2. Protocols</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="types.html">4.5. Data Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="types.html#scalar-types">4.5.1. Scalar Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="types.html#scalar-types-with-encoding">4.5.2. Scalar Types with Encoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="types.html#variable-length-types">4.5.3. Variable Length Types</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../flow/data.html">5. Data Flow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../flow/data.html#input-data">5.1. Input Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flow/data.html#output-data">5.2. Output Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calcite/calcite_parser.html">6. Calcite Parser</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../calcite/calcite_parser.html#communication-between-calcite-and-omniscidb">6.1. Communication between Calcite and OmniSciDB</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../execution/index.html">7. Query Execution</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../execution/overview.html">7.1. Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../execution/overview.html#request-handler-dbhandler">7.1.1. Request Handler (DBHandler)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/overview.html#apache-calcite">7.1.2. Apache Calcite</a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/overview.html#relational-algebra-executor">7.1.3. Relational Algebra Executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/overview.html#relational-algebra-dag-builder-and-optimizer">7.1.4. Relational Algebra Dag Builder and Optimizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/overview.html#relational-algebra-translator">7.1.5. Relational Algebra Translator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/overview.html#executor">7.1.6. Executor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../execution/optimizer.html">7.2. DAG Builder / Optimizer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../execution/optimizer.html#dag-builder">7.2.1. DAG Builder</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../execution/optimizer.html#relalgnode">7.2.1.1. <code class="docutils literal notranslate"><span class="pre">RelAlgNode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/optimizer.html#rex">7.2.1.2. <code class="docutils literal notranslate"><span class="pre">Rex</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../execution/optimizer.html#omniscidb-specific-query-optimization">7.2.2. OmniSciDB Specific Query Optimization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../execution/optimizer.html#mark-noops">7.2.2.1. Mark Noops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/optimizer.html#eliminate-identical-copies">7.2.2.2. Eliminate Identical Copies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/optimizer.html#fold-filters">7.2.2.3. Fold Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/optimizer.html#eliminate-dead-columns">7.2.2.4. Eliminate Dead Columns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/optimizer.html#separate-window-function-expressions">7.2.2.5. Separate Window Function Expressions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/optimizer.html#coalesce-nodes">7.2.2.6. Coalesce Nodes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/optimizer.html#create-left-deep-join">7.2.2.7. Create Left Deep Join</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../execution/scheduler.html">7.3. DAG Execution / Translation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../execution/scheduler.html#determining-execution-order">7.3.1. Determining Execution Order</a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/scheduler.html#raexecutiondescriptor">7.3.2. <code class="docutils literal notranslate"><span class="pre">RaExecutionDescriptor</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/scheduler.html#query-step-translation">7.3.3. Query Step Translation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/scheduler.html#query-step-execution">7.3.4. Query Step Execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../execution/scheduler.html#scalar-subqueries">7.3.4.1. Scalar Subqueries</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../execution/codegen.html">7.4. Code Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../execution/codegen.html#query-templates">7.4.1. Query Templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/codegen.html#codegenerator">7.4.2. <code class="docutils literal notranslate"><span class="pre">CodeGenerator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/codegen.html#runtime-functions-and-extension-functions">7.4.3. Runtime Functions and Extension Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/codegen.html#llvm-optimization-passes">7.4.4. LLVM Optimization Passes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/codegen.html#native-codegen">7.4.5. Native Codegen</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../execution/codegen.html#cpu-native-code-generation">7.4.5.1. CPU Native Code Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/codegen.html#gpu-native-code-generation">7.4.5.2. GPU Native Code Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/codegen.html#code-cache">7.4.5.3. Code Cache</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../execution/codegen.html#troubleshooting">7.4.6. Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../execution/codegen.html#log-files">7.4.6.1. Log Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/codegen.html#automatic-llvm-ir-metadata">7.4.6.2. Automatic LLVM IR Metadata</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../execution/kernels.html">7.5. Execution Kernels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../execution/kernels.html#query-fragment-descriptor">7.5.1. Query Fragment Descriptor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../execution/kernels.html#execution-modes">7.5.1.1. Execution Modes:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../execution/kernels.html#execution-kernel">7.5.2. Execution Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/kernels.html#query-execution-context">7.5.3. Query Execution Context</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../execution/kernels.html#cpu-execution">7.5.3.1. CPU execution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/kernels.html#gpu-execution">7.5.3.2. GPU execution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../execution/results.html">7.6. Query Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../execution/results.html#result-set-storage">7.6.1. Result Set Storage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../execution/results.html#logical-targets-and-physical-slots">7.6.1.1. Logical Targets and Physical Slots</a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/results.html#storage-memory-layouts">7.6.1.2. Storage Memory Layouts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../execution/results.html#group-by-queries">7.6.1.3. Group by Queries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../execution/results.html#reductions">7.6.2. Reductions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../execution/results.html#accessors-and-iterators">7.6.3. Accessors and Iterators</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://doxygen.omnisci.com">Doxygen</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/omnisci/omniscidb">GitHub Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary/index.html">Glossary of Terms</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Detailed Class Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../components/logger.html">Logger</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../components/logger.html#program-options">Program Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/logger.html#initialization-and-global-instances">Initialization and Global Instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/logger.html#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/logger.html#severity">Severity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/logger.html#log-files">Log Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/logger.html#format">Format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/logger.html#channel">Channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/logger.html#macros">Macros</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/logger.html#log">LOG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/logger.html#check">CHECK</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/logger.html#stdlog">STDLOG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/logger.html#debug-timer">DEBUG_TIMER</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../components/query_state.html">QueryState</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../components/query_state.html#classes">Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/query_state.html#example-usage">Example Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/query_state.html#summary">Summary</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OmniSciDB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>DUMP TABLE and RESTORE TABLE Statements</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/data_model/dump_restore.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dump-table-and-restore-table-statements">
<h1>DUMP TABLE and RESTORE TABLE Statements<a class="headerlink" href="#dump-table-and-restore-table-statements" title="Permalink to this headline"></a></h1>
<p><strong>DUMP TABLE</strong> statement archives data files and string dictionary files of a table to a gzip-compressed tar file.</p>
<p><strong>RESTORE TABLE</strong> statement restores or migrates data files and string dictionary files of a table from a gzip-compressed tar file.</p>
<section id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline"></a></h2>
<p>DUMP TABLE <em>table</em> TO <em>‘tgz_file_path`</em>;</p>
<p>RESTORE TABLE <em>table</em> FROM <em>‘tgz_file_path`</em>;</p>
<p>Note: When table <em>table</em> does not exist in current database, RESTORE TABLE creates a new table named <em>table</em> and migrates the table files in <em>tgz_file_path</em> to the table.</p>
</section>
<section id="file-format">
<h2>File Format<a class="headerlink" href="#file-format" title="Permalink to this headline"></a></h2>
<p>Inside the tar archive, <strong>native</strong> Omnisci file formats are reused instead of inventing new ones for dumping table data and dictionary files. The native formats are proven simple and solid and so is existing code that accesses files of the formats.</p>
<p>Files in native OmniSci formats are easy to accommodate onto target database where they are to be restored or migrated. In rare cases when rows archived in files need to be refragmented or redistributed (e.g, need to be resharded) on target database, there is no problem on accessing the rows belonging to individual fragments stored in data files, thanks to the existing code mentioned above.</p>
<p>Note:</p>
<ul class="simple">
<li><p>Using native Omnisci file formats means that DUMP TABLE archives metadata and data pages of <strong>all versions</strong> by default. Archives may consume more disk storage space than necessary for latest pages. To minimize storage usage and speed up later table restore, if a table has experienced a signficant number of UPDATE/DELETE/ INSERT of small batches of data thus leaving excessive amount of old pages in data files, it is recommended to optimize the table (in place) beforehand, for example by running <strong>OPTIMIZE TABLE</strong> statement with (VACUUM=’<strong>PAGES</strong>’) option to trim old pages in the data files (when the option becomes available). Methods that trim pages not insitu would require extra storage to buffer pages before they are archived.</p></li>
<li><p>Currently there is no support of resharding or refragmentization, for example on migrating a 3-shard table to become 4-shard. It is doable in next releases if necessary.</p></li>
</ul>
</section>
<section id="dump-table">
<h2>DUMP TABLE<a class="headerlink" href="#dump-table" title="Permalink to this headline"></a></h2>
<p>Besides data files and dictionary files of a table, DUMP TABLE creates and includes the following files in the tar file:</p>
<ul class="simple">
<li><p><strong>_table.sql</strong> - contains table schema in a SQL <strong>CREATE TABLE</strong> statement which will be used to create a new table when migrating the table to another database using <strong>RESTORE TABLE</strong> statement.</p></li>
<li><p><strong>_table.oldinfo</strong> - contains table information that is used to migrate the table. The information consists of:</p>
<ul>
<li><p>column Ids of the dumped table (aka. “source” table)</p></li>
<li><p>dictionary file paths which assist in rebuilding dictionary references on table migration</p></li>
</ul>
</li>
<li><p><strong>_table.epoch</strong> - contains current epoch of the table.</p></li>
</ul>
<p>File <strong>_table.oldinfo</strong> contains a list of space delimited strings, each of which corresponds to a column in the table and is formatted as <em>column_name</em>:<em>column_id</em>:<em>dictionary_path</em>. For none text or none encoded text column, <em>dictionary_path</em> is a empty string.</p>
<p>For example, for a table <em>t</em> which was created using the following SQL statement:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span><span class="w"> </span><span class="n">TABLE</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="n">s</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="n">d</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="n">f</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">SHARED</span><span class="w"> </span><span class="n">DICTIONARY</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="n">REFERENCES</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="w"></span>
<span class="n">SHARED</span><span class="w"> </span><span class="n">DICTIONARY</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="n">REFERENCES</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="w"> </span><span class="n">SHARD</span><span class="w"> </span><span class="n">KEY</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="n">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">FRAGMENT_SIZE</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">SHARD_COUNT</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>executing the following DUMP TABLE statement:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>DUMP TABLE t TO &#39;/tmp/Orz_.tgz&#39;;
</pre></div>
</div>
<p>creates the tar file <strong>/tmp/Orz.tgz</strong> consisting of the following files:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$tar xvfz /tmp/Orz.tgz
_table.sql
_table.oldinfo
_table.epoch
table_1_5/
table_1_5/0.2097152.mapd
table_1_5/epoch
table_1_5/1.4096.mapd
table_1_6/
table_1_6/0.2097152.mapd
table_1_6/epoch
table_1_6/1.4096.mapd
DB_1_DICT_2/
DB_1_DICT_2/DictOffsets
DB_1_DICT_2/DictPayload
DB_1_DICT_1/
DB_1_DICT_1/DictOffsets
DB_1_DICT_1/DictPayload

$ cat _table.sql
CREATE TABLE @T (i INTEGER, j INTEGER, s TEXT ENCODING DICT(32), d TEXT, f TEXT ENCODING DICT(32), SHARED DICTIONARY (d) REFERENCES @T(s), SHARD KEY(i)) WITH (FRAGMENT_SIZE=10, MAX_CHUNK_SIZE=1073741824, PAGE_SIZE=2097152, MAX_ROWS=4611686018427387904, VACUUM=&#39;DELAYED&#39;, SHARD_COUNT=2);

$ cat _table.oldinfo
i:1: j:2: s:3:DB_1_DICT_2 d:4:DB_1_DICT_2 f:5:DB_1_DICT_1 rowid:6: $deleted$:7:

$ cat _table.epoch
50
</pre></div>
</div>
</section>
<section id="restore-table">
<h2>RESTORE TABLE<a class="headerlink" href="#restore-table" title="Permalink to this headline"></a></h2>
<p>On executing a <strong>RESTORE TABLE</strong> statement, OmniSci core will accommodate those data and dict files archived in the input tar file to base directory of current database.</p>
<p>When restoring a table (ie. the table exists in current database) data and dict files in input tar file directly replace the counterparts in base directory of current database. No adjustment to the files are necessary.</p>
<p><strong>Note:</strong> To facilitate rollback in case of any exception during the course of processing the statement, existing data and dict files are backed up to a temporary directory and are restored when any exception happens.</p>
<p>Omnisci core processing <strong>table migration</strong> (ie. the table doesn’t exists) in current database, handling is similar to the way it processes table recovery, except that the numbering (ie. table id) of data and dict files in current database can differ from that of those files in the tar file, and except in the case when schema of the table had been altered through any <strong>ALTER TABLE ADD/DELETE COLUMN</strong> statement before it was archived, and hence column IDs can differ between source and target or destination tables.</p>
<p>For the former exception above, core renames input data and dict files accordingly. For the latter, core will scan all data files of the table and adjust column ids in related chunk headers.</p>
<p>Overall, core follows these steps to process RESTORE TABLE statements:</p>
<ul class="simple">
<li><p>reads in source table schema (ref. file <strong>_table.sql</strong>)</p></li>
<li><p>(table migration only) creates the table in current database</p></li>
<li><p>grabs WRITE lock on the table and READ lock on catalog</p></li>
<li><p>checks schema compatibility between source and target tables</p></li>
<li><p>builds a map of column IDs between source and target tables to check whether source table had been altered and for later adjustment of chunk headers in case the table had been altered. (ref. file <strong>_table.oldinfo</strong>)</p></li>
<li><p>builds a map of dict file paths between source and target tables for later rename of source dict files. (ref. file <strong>_table.oldinfo</strong>)</p></li>
<li><p>untars the tar file to a temporary directory</p></li>
<li><p>adjusts chunk headers if source table had been altered</p></li>
<li><p>backs up (move only; not copy) existing data and dict files of the table to another temporary directory</p></li>
<li><p>renames data files of the table</p></li>
<li><p>renames dict files of the table</p></li>
<li><p>set table epoch of the target table to that of the source table (ref. file <strong>_table.epoch</strong>)</p></li>
</ul>
<p>In case of runtime exception during processing, existing data and dict files are restored.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, OmniSci, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>